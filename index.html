<!DOCTYPE html>
<!-- Trigger redeploy for GitHub Pages - Force update - Firewall Removed -->
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My DNA Diet üß¨</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.1/dist/tesseract.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", sans-serif;
      background-color: #4b0082;
      color: #fff;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
    }
    h1, h2, h3 {
      text-align: center;
      color: #fff;
    }
    .pet-selector {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
    }
    .pet-button {
      padding: 10px 20px;
      border: none;
      border-radius: 30px;
      font-size: 16px;
      background-color: #9c59d1;
      color: #fff;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .pet-button.active {
      background-color: #fff;
      color: #4b0082;
    }
    .clear-button {
      background-color: #d96fd6;
    }
    .clear-button:hover {
      background-color: #e88ae6;
    }
    .section {
      background-color: #fff;
      color: #333;
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 20px;
    }
    .section h3 {
      margin-top: 0;
      color: #4b0082;
    }
    .intolerance {
      padding: 8px 12px;
      margin: 5px 0;
      border-radius: 8px;
      background-color: #f5f5f5;
      color: #000;
    }
    .level-3 {
      background-color: #ffcccc;
      color: red;
    }
    .level-2 {
      background-color: #fff3cd;
      color: #b76b00;
    }
    .results {
      margin-top: 20px;
    }
    .search-input {
      width: 100%;
      padding: 10px;
      margin-bottom: 20px;
      border-radius: 8px;
      border: none;
    }
    .button-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin-bottom: 20px;
    }
    .button-row button {
      flex: 1 1 40%;
      padding: 12px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .export-btn {
      background-color: #28a745;
      color: #fff;
    }
    .test-btn {
      background-color: #007bff;
      color: #fff;
    }
    .scan-btn {
      background-color: #6f42c1;
      color: #fff;
    }
    .diet-btn {
      background-color: #fd7e14;
      color: #fff;
    }
    .terms-btn {
      background-color: #6c757d;
      color: #fff;
    }
    .footer {
      text-align: center;
      font-size: 14px;
      margin-top: 40px;
      color: #ddd;
    }
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .modal-content {
      background: white;
      color: #000;
      padding: 20px;
      border-radius: 12px;
      width: 90%;
      max-width: 400px;
      text-align: center;
    }
    .modal-content h2 {
      color: #4b0082;
    }
    .modal-content button {
      margin-top: 15px;
      padding: 10px 20px;
      background-color: #4b0082;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    #app-content {
      display: block;
    }
    
    /* Scanner modal minimized state */
    .modal-content.minimized {
      max-width: 400px !important;
      max-height: 60vh !important;
    }
    
    .modal-content.minimized #scannerMainContent {
      font-size: 0.9em;
    }
    
    .modal-content.minimized video,
    .modal-content.minimized canvas,
    .modal-content.minimized img {
      max-height: 200px !important;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>My DNA Diet üß¨</h1>

    <!-- Login section removed - no authentication required -->

    <div id="app-content">
      <div id="petSelector" class="pet-selector">
        <div class="profile-item">
          <button class="pet-button" onclick="selectPet('Don')">üßî Don</button>
          <button class="remove-profile" onclick="removeProfile('Don')" title="Remove Don's profile">‚ùå</button>
        </div>
        <div class="profile-item">
          <button class="pet-button" onclick="selectPet('Lora')">üë© Lora</button>
          <button class="remove-profile" onclick="removeProfile('Lora')" title="Remove Lora's profile">‚ùå</button>
        </div>
        <div class="profile-item">
          <button class="pet-button" onclick="selectPet('Mocha')">üê∂ Mocha</button>
          <button class="remove-profile" onclick="removeProfile('Mocha')" title="Remove Mocha's profile">‚ùå</button>
        </div>
        <div class="profile-item">
          <button class="pet-button" onclick="selectPet('Punkin')">üê∂ Punkin</button>
          <button class="remove-profile" onclick="removeProfile('Punkin')" title="Remove Punkin's profile">‚ùå</button>
        </div>
        <button id="userProfileBtn" class="pet-button" onclick="selectPet('My Profile')" style="display: none;">üë§ My Profile</button>
      </div>

      <div class="button-row">
        <button class="export-btn" onclick="exportCSV()">üìÅ Export CSV</button>
        <button class="test-btn" onclick="testFood()">Test Ingredient üß¨</button>
        <button class="scan-btn" onclick="openScanModal()">üì∏ Scan</button>
        <button class="diet-btn" onclick="viewDiet()">My Diet Plan üìã</button>
        <button class="upload-btn" onclick="openUploadModal()">üì§ Upload Intolerances</button>
        <button class="terms-btn" onclick="viewTerms()">üìú Terms</button>
      </div>

      <div class="results" id="scanResults">
        <!-- Scan results will appear here -->
      </div>

      <section id="test-food-section" class="section">
        <h3>Test a Food Item</h3>
        <textarea id="testFoodInput" placeholder="Enter food ingredients here..." rows="4" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd; font-family: inherit; margin-bottom: 10px;"></textarea>
        <button class="test-btn" onclick="testFood()">Analyze</button>
        <div id="testFoodResults"></div>
      </section>

      <section id="diet-plan-section" class="section">
        <h3>Upload a Diet Plan</h3>
        <input type="file" id="dietPlanUpload" accept=".txt" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd; font-family: inherit; margin-bottom: 10px;">
        <button class="diet-btn" onclick="viewDiet()">Analyze Diet Plan</button>
        <div id="dietPlanResults"></div>
      </section>

      <div id="sharedIntolerances" class="section">
        <h3>Shared Intolerances</h3>
        <div id="sharedList"></div>
      </div>

      <div id="uniqueIntolerances" class="section">
        <h3>Unique Intolerances</h3>
        <div id="uniqueList"></div>
      </div>

      <div class="footer">
        ¬© 2025 EmberWorldWide Productions LLC. All rights reserved. My DNA Diet‚Ñ¢.
      </div>
    </div>

    <!-- Scan Modal -->
    <div id="scannerModule" class="modal" style="display: none;">
      <div class="modal-content" id="scannerModalContent" style="max-width: 600px; max-height: 80vh; overflow-y: auto; position: relative;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
          <h2 style="margin: 0;">üì∏ Scan Food Label</h2>
          <div>
            <button id="minimizeScanner" style="background-color: #6c757d; color: white; border: none; border-radius: 4px; padding: 5px 10px; margin-right: 5px; cursor: pointer;">üì±</button>
            <button id="closeScanner" style="background-color: #dc3545; color: white; border: none; border-radius: 4px; padding: 5px 10px; cursor: pointer;">‚ùå</button>
          </div>
        </div>
        
        <div id="scannerMainContent">
          <video id="video" autoplay muted playsinline style="width: 100%; max-height: 300px; border-radius: 8px; margin-bottom: 10px; object-fit: cover;"></video>
          <canvas id="canvas" style="width: 100%; max-height: 300px; border-radius: 8px; margin-bottom: 10px; display: none; object-fit: cover;"></canvas>
          <img id="photoPreview" style="width: 100%; max-height: 300px; border-radius: 8px; margin-bottom: 10px; display: none; object-fit: cover;" alt="Preview">
          
          <div class="scanner-buttons" style="margin-bottom: 15px; display: flex; flex-wrap: wrap; gap: 5px; justify-content: center;">
            <button id="startCamera" style="background-color: #28a745; color: white; border: none; border-radius: 4px; padding: 8px 12px; cursor: pointer;">üì∑ Start Camera</button>
            <button id="flipCameraBtn" style="background-color: #6c757d; color: white; border: none; border-radius: 4px; padding: 8px 12px; cursor: pointer;">üîÑ Flip Camera</button>
            <button id="capturePhoto" style="background-color: #007bff; color: white; border: none; border-radius: 4px; padding: 8px 12px; display: none; cursor: pointer;">üì∏ Capture Photo</button>
            <button id="retakePhoto" style="background-color: #ffc107; color: white; border: none; border-radius: 4px; padding: 8px 12px; display: none; cursor: pointer;">üîÑ Retake</button>
            <button id="processPhoto" style="background-color: #28a745; color: white; border: none; border-radius: 4px; padding: 8px 12px; display: none; cursor: pointer;">‚úÖ Process Photo</button>
          </div>
          
          <div style="text-align: center; margin-bottom: 15px;">
            <input type="file" id="fileInput" accept="image/*" style="padding: 8px; border: 2px dashed #ccc; border-radius: 8px; width: 100%; max-width: 300px;">
          </div>
          
          <div id="scanStatus" style="text-align: center; padding: 10px; min-height: 20px;"></div>
        </div>
      </div>
    </div>

    <!-- Upload Intolerances Modal -->
    <div id="uploadModal" class="modal" style="display: none;">
      <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
          <h2 style="margin: 0;">üì§ Upload Personal Intolerances</h2>
          <button id="closeUpload" style="background-color: #dc3545; color: white; border: none; border-radius: 4px; padding: 5px 10px; cursor: pointer;">‚ùå</button>
        </div>
        
        <div style="background: #e3f2fd; border: 1px solid #2196f3; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
          <h4 style="margin: 0 0 10px 0; color: #1976d2;">üí° Pro Tip</h4>
          <p style="margin: 0; color: #1565c0;">For a truly personalized experience, you can remove the example profiles (Don, Lora, Mocha, Punkin) by clicking the ‚ùå buttons next to their names. This will make the app focus entirely on your personal data!</p>
        </div>
        
        <div style="margin-bottom: 20px;">
          <h3>Option 1: Upload JSON File</h3>
          <p>Upload a JSON file with your intolerance data in this format:</p>
          <pre style="background: #f5f5f5; padding: 10px; border-radius: 4px; font-size: 12px; overflow-x: auto;">
{
  "name": "Your Name",
  "type": "human",
  "intolerances": [
    { "item": "Gluten", "category": "Grain", "level": 3 },
    { "item": "Dairy", "category": "Dairy", "level": 2 }
  ]
}</pre>
          <div style="margin-bottom: 10px;">
            <a href="sample-intolerances-template.json" download style="color: #007bff; text-decoration: none;">üì• Download Sample Template</a>
          </div>
          <input type="file" id="jsonUpload" accept=".json" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd; margin-bottom: 10px;">
          <button onclick="uploadJSONFile()" style="background-color: #28a745; color: white; border: none; border-radius: 4px; padding: 8px 16px; cursor: pointer;">Upload JSON</button>
        </div>

        <div style="margin-bottom: 20px;">
          <h3>Option 2: Manual Entry</h3>
          <div style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 10px; align-items: end; margin-bottom: 10px;">
            <input type="text" id="itemInput" placeholder="Food Item" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            <select id="categoryInput" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
              <option value="Protein">Protein</option>
              <option value="Grain">Grain</option>
              <option value="Dairy">Dairy</option>
              <option value="Nuts">Nuts</option>
              <option value="Seafood">Seafood</option>
              <option value="Fruit">Fruit</option>
              <option value="Vegetable">Vegetable</option>
              <option value="Additive">Additive</option>
              <option value="Other">Other</option>
            </select>
            <select id="levelInput" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
              <option value="1">Level 1 (Mild)</option>
              <option value="2">Level 2 (Moderate)</option>
              <option value="3">Level 3 (Severe)</option>
            </select>
            <button onclick="addIntoleranceItem()" style="background-color: #007bff; color: white; border: none; border-radius: 4px; padding: 8px 16px; cursor: pointer;">Add</button>
          </div>
        </div>

        <div style="margin-bottom: 20px;">
          <h3>Current Intolerances</h3>
          <div id="currentIntolerances" style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; padding: 10px; background: #f9f9f9;">
            <!-- Current items will be displayed here -->
          </div>
        </div>

        <div style="display: flex; gap: 10px; justify-content: center;">
          <button onclick="saveIntolerances()" style="background-color: #28a745; color: white; border: none; border-radius: 4px; padding: 10px 20px; cursor: pointer;">üíæ Save Changes</button>
          <button onclick="exportCurrentIntolerances()" style="background-color: #17a2b8; color: white; border: none; border-radius: 4px; padding: 10px 20px; cursor: pointer;">üì• Export Current List</button>
          <button onclick="clearAllIntolerances()" style="background-color: #dc3545; color: white; border: none; border-radius: 4px; padding: 10px 20px; cursor: pointer;">üóëÔ∏è Clear All</button>
        </div>
      </div>
    </div>

    <!-- Terms Modal -->
    <div id="termsModal" class="modal" style="display: none;">
      <div class="modal-content">
        <div style="padding: 1rem; font-family: Arial, sans-serif; max-height: 70vh; overflow-y: auto;">
          <h2 style="text-align: center;">Terms of Service & Privacy Policy</h2>
          <p style="text-align: center;"><em>Effective Date: August 4, 2025</em><br>
          <strong>Publisher:</strong> Ember Worldwide Productions LLC</p>

          <h3>1. Use at Your Own Risk</h3>
          <p>This app is provided for informational and entertainment purposes only. It is not intended to diagnose, treat, or replace medical advice from a licensed professional. You assume full responsibility for any dietary decisions made using this tool.</p>

          <h3>2. No Medical or Nutritional Liability</h3>
          <p>My DNA Diet offers food intolerance insights based on user-provided or third-party data. The creators make no warranties regarding the accuracy, completeness, or fitness of any information provided. Always consult a healthcare provider before making dietary changes.</p>

          <h3>3. Privacy & Data Collection</h3>
          <ul>
            <li>No login is required</li>
            <li>No personal identifiers are transmitted</li>
            <li>Camera access is used only for scanning labels and is not recorded or stored</li>
            <li>Ingredient data is processed locally and not saved to any server</li>
          </ul>
          <p>If future versions implement cloud features or authentication, this policy will be updated accordingly.</p>

          <h3>4. Intellectual Property</h3>
          <p>All content and functionality within the app ‚Äî including branding, layout, and code ‚Äî are property of Ember Worldwide Productions LLC. Unauthorized reproduction, reverse engineering, or redistribution is prohibited.</p>

          <h3>5. Acceptable Use</h3>
          <p>Users agree not to abuse, interfere with, or attempt to reverse-engineer any part of the application. Automated tools, scraping bots, or malicious inputs are prohibited.</p>

          <h3>6. Changes to the App</h3>
          <p>Features may be modified, added, or removed at any time without notice. Continued use of the app signifies acceptance of any changes.</p>

          <h3>7. Contact</h3>
          <p>For inquiries or legal questions, contact us at:<br>
          <strong>contact@emberworldwide.com</strong></p>

          <p style="margin-top: 2rem;"><strong>By using this app, you agree to these Terms of Service and Privacy Policy.</strong></strong></p>
        </div>
        <button onclick="closeTermsModal()">Close</button>
      </div>
    </div>

    <script src="script.js"></script>
  </div>
</body>
</html>
