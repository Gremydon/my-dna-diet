<!DOCTYPE html>
<!-- Trigger redeploy for GitHub Pages - Force update - Firewall Removed -->
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My DNA Diet ğŸ§¬</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.1/dist/tesseract.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <script>
    // Configure PDF.js worker
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
  </script>
  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", sans-serif;
      background-color: #4b0082;
      color: #fff;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
    }
    h1, h2, h3 {
      text-align: center;
      color: #fff;
    }
    .pet-selector {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
    }
    .profile-item {
      display: flex;
      align-items: center;
      gap: 8px;
      width: 100%;
      max-width: 300px;
      justify-content: center;
    }
    .pet-button {
      padding: 10px 20px;
      border: none;
      border-radius: 30px;
      font-size: 16px;
      background-color: #9c59d1;
      color: #fff;
      cursor: pointer;
      transition: background-color 0.3s;
      flex: 1;
      max-width: 200px;
    }
    .pet-button.active {
      background-color: #fff;
      color: #4b0082;
    }
    .remove-profile {
      background-color: #dc3545;
      color: white;
      border: none;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.3s;
    }
    .remove-profile:hover {
      background-color: #c82333;
    }
    .clear-button {
      background-color: #d96fd6;
    }
    .clear-button:hover {
      background-color: #e88ae6;
    }
    .section {
      background-color: #fff;
      color: #333;
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 20px;
    }
    .section h3 {
      margin-top: 0;
      color: #4b0082;
    }
    .intolerance {
      padding: 8px 12px;
      margin: 5px 0;
      border-radius: 8px;
      background-color: #f5f5f5;
      color: #000;
    }
    .level-3 {
      background-color: #ffcccc;
      color: red;
    }
    .level-2 {
      background-color: #fff3cd;
      color: #b76b00;
    }
    .results {
      margin-top: 20px;
    }
    .search-input {
      width: 100%;
      padding: 10px;
      margin-bottom: 20px;
      border-radius: 8px;
      border: none;
    }
    .button-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin-bottom: 20px;
    }
    .button-row button {
      flex: 1 1 40%;
      padding: 12px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .export-btn {
      background-color: #28a745;
      color: #fff;
    }
    .test-btn {
      background-color: #007bff;
      color: #fff;
    }
    .scan-btn {
      background-color: #6f42c1;
      color: #fff;
    }
    .diet-btn {
      background-color: #fd7e14;
      color: #fff;
    }
    .terms-btn {
      background-color: #6c757d;
      color: #fff;
    }
    .footer {
      text-align: center;
      font-size: 14px;
      margin-top: 40px;
      color: #ddd;
    }
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .modal-content {
      background: white;
      color: #000;
      padding: 20px;
      border-radius: 12px;
      width: 90%;
      max-width: 400px;
      text-align: center;
    }
    .modal-content h2 {
      color: #4b0082;
    }
    .modal-content button {
      margin-top: 15px;
      padding: 10px 20px;
      background-color: #4b0082;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    #app-content {
      display: block;
    }
    
    /* Scanner modal minimized state */
    .modal-content.minimized {
      max-width: 400px !important;
      max-height: 60vh !important;
    }
    
    .modal-content.minimized #scannerMainContent {
      font-size: 0.9em;
    }
    
    .modal-content.minimized video,
    .modal-content.minimized canvas,
    .modal-content.minimized img {
      max-height: 200px !important;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>My DNA Diet ğŸ§¬</h1>

    <!-- Login section removed - no authentication required -->

    <div id="app-content">
      <!-- Welcome message for new users -->
      <div id="welcomeMessage" class="section" style="text-align: center; background: linear-gradient(135deg, #e8f5e8, #f0f8ff); border: 2px solid #4caf50; margin-bottom: 25px;">
        <h3 style="margin: 0 0 15px 0; color: #1976d2;">ğŸš€ Welcome to My DNA Diet!</h3>
        <p style="margin: 0 0 15px 0; color: #1565c0; font-size: 16px;">
          Upload your 5Strands report, DNA test results, or create a custom profile to start scanning food labels!
        </p>
        <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
          <button onclick="showOnboarding()" style="background-color: #4b0082; color: white; border: none; border-radius: 8px; padding: 12px 20px; cursor: pointer; font-size: 14px;">
            ğŸ§¬ Create My Profile
          </button>
          <button onclick="openUploadModal()" style="background-color: #28a745; color: white; border: none; border-radius: 8px; padding: 12px 20px; cursor: pointer; font-size: 14px;">
            ğŸ“¤ Upload 5Strands Report
          </button>
        </div>
      </div>
      <div id="petSelector" class="pet-selector">
        <div class="profile-item" id="donProfile">
          <button class="pet-button" onclick="selectPet('Don')">ğŸ§” Don</button>
          <button class="remove-profile" onclick="removeProfile('Don')" title="Remove Don's profile">âŒ</button>
        </div>
        <div class="profile-item" id="loraProfile">
          <button class="pet-button" onclick="selectPet('Lora')">ğŸ‘© Lora</button>
          <button class="remove-profile" onclick="removeProfile('Lora')" title="Remove Lora's profile">âŒ</button>
        </div>
        <div class="profile-item" id="mochaProfile">
          <button class="pet-button" onclick="selectPet('Mocha')">ğŸ¶ Mocha</button>
          <button class="remove-profile" onclick="removeProfile('Mocha')" title="Remove Mocha's profile">âŒ</button>
        </div>
        <div class="profile-item" id="punkinProfile">
          <button class="pet-button" onclick="selectPet('Punkin')">ğŸ¶ Punkin</button>
          <button class="remove-profile" onclick="removeProfile('Punkin')" title="Remove Punkin's profile">âŒ</button>
        </div>
        <button id="userProfileBtn" class="pet-button" onclick="selectPet('My Profile')" style="display: none;">ğŸ‘¤ My Profile</button>
        
        <div style="margin-top: 15px; text-align: center;">
          <button id="toggleExampleProfiles" onclick="toggleExampleProfiles()" style="background-color: #6c757d; color: white; border: none; border-radius: 6px; padding: 8px 16px; cursor: pointer; font-size: 12px;">
            ğŸ‘¥ Show/Hide Example Profiles
          </button>
        </div>
      </div>

      <div class="button-row">
        <button class="export-btn" onclick="exportCSV()">ğŸ“ Export CSV</button>
        <button class="test-btn" onclick="openTestIngredientModal()">Test Ingredient ğŸ§¬</button>
        <button class="scan-btn" onclick="openScanModal()">ğŸ“¸ Scan</button>
        <button class="diet-btn" onclick="openDietPlanModal()">My Diet Plan ğŸ“‹</button>
        <button class="upload-btn" onclick="openUploadModal()">ğŸ“¤ Upload Intolerances</button>
        <button class="help-btn" onclick="showOnboarding()">â“ Create Profile</button>
        <button class="terms-btn" onclick="viewTerms()">ğŸ“œ Terms</button>
      </div>

      <div class="results" id="scanResults">
        <!-- Scan results will appear here -->
      </div>



      <div id="sharedIntolerances" class="section">
        <h3>Shared Intolerances</h3>
        <div id="sharedList"></div>
      </div>

      <div id="uniqueIntolerances" class="section">
        <h3>Unique Intolerances</h3>
        <div id="uniqueList"></div>
      </div>

      <div class="footer">
        Â© 2025 EmberWorldWide Productions LLC. All rights reserved. My DNA Dietâ„¢.
      </div>
    </div>

    <!-- Scan Modal -->
    <div id="scannerModule" class="modal" style="display: none;">
      <div class="modal-content" id="scannerModalContent" style="max-width: 600px; max-height: 80vh; overflow-y: auto; position: relative;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
          <h2 style="margin: 0;">ğŸ“¸ Scan Food Label</h2>
          <div>
            <button id="minimizeScanner" style="background-color: #6c757d; color: white; border: none; border-radius: 4px; padding: 5px 10px; margin-right: 5px; cursor: pointer;">ğŸ“±</button>
            <button id="closeScanner" style="background-color: #dc3545; color: white; border: none; border-radius: 4px; padding: 5px 10px; cursor: pointer;">âŒ</button>
          </div>
        </div>
        
        <div id="scannerMainContent">
          <video id="video" autoplay muted playsinline style="width: 100%; max-height: 300px; border-radius: 8px; margin-bottom: 10px; object-fit: cover;"></video>
          <canvas id="canvas" style="width: 100%; max-height: 300px; border-radius: 8px; margin-bottom: 10px; display: none; object-fit: cover;"></canvas>
          <img id="photoPreview" style="width: 100%; max-height: 300px; border-radius: 8px; margin-bottom: 10px; display: none; object-fit: cover;" alt="Preview">
          
          <div class="scanner-buttons" style="margin-bottom: 15px; display: flex; flex-wrap: wrap; gap: 5px; justify-content: center;">
            <button id="startCamera" style="background-color: #28a745; color: white; border: none; border-radius: 4px; padding: 8px 12px; cursor: pointer;">ğŸ“· Start Camera</button>
            <button id="flipCameraBtn" style="background-color: #6c757d; color: white; border: none; border-radius: 4px; padding: 8px 12px; cursor: pointer;">ğŸ”„ Flip Camera</button>
            <button id="capturePhoto" style="background-color: #007bff; color: white; border: none; border-radius: 4px; padding: 8px 12px; display: none; cursor: pointer;">ğŸ“¸ Capture Photo</button>
            <button id="retakePhoto" style="background-color: #ffc107; color: white; border: none; border-radius: 4px; padding: 8px 12px; display: none; cursor: pointer;">ğŸ”„ Retake</button>
            <button id="processPhoto" style="background-color: #28a745; color: white; border: none; border-radius: 4px; padding: 8px 12px; display: none; cursor: pointer;">âœ… Process Photo</button>
          </div>
          
          <div style="text-align: center; margin-bottom: 15px;">
            <input type="file" id="fileInput" accept="image/*" style="padding: 8px; border: 2px dashed #ccc; border-radius: 8px; width: 100%; max-width: 300px;">
          </div>
          
          <div id="scanStatus" style="text-align: center; padding: 10px; min-height: 20px;"></div>
        </div>
      </div>
    </div>

    <!-- Upload Intolerances Modal -->
    <div id="uploadModal" class="modal" style="display: none;">
      <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
          <h2 style="margin: 0;">ğŸ“¤ Upload Personal Intolerances</h2>
          <button id="closeUpload" style="background-color: #dc3545; color: white; border: none; border-radius: 4px; padding: 5px 10px; cursor: pointer;">âŒ</button>
        </div>
        
        <div style="background: #e3f2fd; border: 1px solid #2196f3; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
          <h4 style="margin: 0 0 10px 0; color: #1976d2;">ğŸ’¡ Pro Tip</h4>
          <p style="margin: 0; color: #1565c0;">For a truly personalized experience, you can remove the example profiles (Don, Lora, Mocha, Punkin) by clicking the âŒ buttons next to their names. This will make the app focus entirely on your personal data!</p>
        </div>
        
        <div style="background: #f3e5f5; border: 1px solid #9c27b0; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
          <h4 style="margin: 0 0 10px 0; color: #7b1fa2;">ğŸ”’ Privacy & Safety</h4>
          <p style="margin: 0; color: #6a1b9a;">This app uses isolated storage that cannot interfere with other apps on your device. Your data is stored locally and safely.</p>
        </div>
        
        <div style="margin-bottom: 20px;">
          <h3>Option 1: Upload Files</h3>
          <p>Upload various file types to add your intolerance data:</p>
          
          <div style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
            <h4 style="margin: 0 0 10px 0; color: #495057;">ğŸ“ File Upload - Multiple Formats Supported</h4>
            <div style="background: white; padding: 10px; border-radius: 6px; border-left: 4px solid #28a745;">
              <strong>ğŸ“„ JSON</strong><br>
              <small>Direct intolerance data import</small>
            </div>
            <div style="background: white; padding: 10px; border-radius: 6px; border-left: 4px solid #17a2b8; margin-top: 8px;">
              <strong>ğŸ“Š CSV/Excel</strong><br>
              <small>Spreadsheet data from 5Strands or other sources</small>
            </div>
            <div style="background: white; padding: 10px; border-radius: 6px; border-left: 4px solid #6f42c1; margin-top: 8px;">
              <strong>ğŸ“‹ PDF</strong><br>
              <small>5Strands reports and other PDF documents</small>
            </div>
            <div style="background: white; padding: 10px; border-radius: 6px; border-left: 4px solid #fd7e14; margin-top: 8px;">
              <strong>ğŸ“ TXT/DOCX</strong><br>
              <small>Text documents and Word files</small>
            </div>
          </div>
          
          <div style="margin-bottom: 10px;">
            <a href="sample-intolerances-template.json" download style="color: #007bff; text-decoration: none;">ğŸ“¥ Download Sample JSON Template</a>
            <span style="margin: 0 10px;">|</span>
            <a href="sample-ingredients-template.csv" download style="color: #007bff; text-decoration: none;">ğŸ“¥ Download Sample CSV Template</a>
          </div>
          
          <input type="file" id="fileUpload" accept=".json,.pdf,.docx,.txt,.csv,.xlsx,.xls" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd; margin-bottom: 10px;">
          <div style="font-size: 12px; color: #666; margin-bottom: 10px; text-align: center;">
            ğŸ’¡ Now supporting: JSON, PDF, CSV, Excel, TXT, DOCX files! Perfect for 5Strands reports.
          </div>
          <button onclick="processUploadedFile()" style="background-color: #28a745; color: white; border: none; border-radius: 4px; padding: 8px 16px; cursor: pointer;">ğŸ“¤ Process File</button>
          
          <div id="uploadStatus" style="margin-top: 10px; padding: 10px; border-radius: 6px; display: none;"></div>
        </div>

        <div style="margin-bottom: 20px;">
          <h3>Option 2: Manual Entry</h3>
          <div style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 10px; align-items: end; margin-bottom: 10px;">
            <input type="text" id="itemInput" placeholder="Food Item" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            <select id="categoryInput" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
              <option value="Protein">Protein</option>
              <option value="Grain">Grain</option>
              <option value="Dairy">Dairy</option>
              <option value="Nuts">Nuts</option>
              <option value="Seafood">Seafood</option>
              <option value="Fruit">Fruit</option>
              <option value="Vegetable">Vegetable</option>
              <option value="Additive">Additive</option>
              <option value="Other">Other</option>
            </select>
            <select id="levelInput" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
              <option value="1">Level 1 (Mild)</option>
              <option value="2">Level 2 (Moderate)</option>
              <option value="3">Level 3 (Severe)</option>
            </select>
            <button onclick="addIntoleranceItem()" style="background-color: #007bff; color: white; border: none; border-radius: 4px; padding: 8px 16px; cursor: pointer;">Add</button>
          </div>
        </div>

        <div style="margin-bottom: 20px;">
          <h3>Current Intolerances</h3>
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <span style="font-size: 14px; color: #666;">Your uploaded intolerances will appear here</span>
            <button onclick="refreshProfileData()" style="background-color: #6c757d; color: white; border: none; border-radius: 4px; padding: 6px 12px; cursor: pointer; font-size: 12px;">ğŸ”„ Refresh</button>
          </div>
          <div id="currentIntolerances" style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; padding: 10px; background: #f9f9f9;">
            <!-- Current items will be displayed here -->
          </div>
        </div>

        <div style="display: flex; gap: 10px; justify-content: center;">
          <button onclick="saveIntolerances()" style="background-color: #28a745; color: white; border: none; border-radius: 4px; padding: 10px 20px; cursor: pointer;">ğŸ’¾ Save Changes</button>
          <button onclick="exportCurrentIntolerances()" style="background-color: #17a2b8; color: white; border: none; border-radius: 4px; padding: 10px 20px; cursor: pointer;">ğŸ“¥ Export Current List</button>
          <button onclick="clearAllIntolerances()" style="background-color: #dc3545; color: white; border: none; border-radius: 4px; padding: 10px 20px; cursor: pointer;">ğŸ—‘ï¸ Clear All</button>
        </div>
      </div>
    </div>

    <!-- Test Ingredient Modal -->
    <div id="testIngredientModal" class="modal" style="display: none;">
      <div class="modal-content" style="max-width: 600px; max-height: 80vh; overflow-y: auto;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h2 style="margin: 0; color: #4b0082;">ğŸ§¬ Test Food Ingredients</h2>
          <button onclick="closeTestIngredientModal()" style="background-color: #dc3545; color: white; border: none; border-radius: 4px; padding: 8px 12px; cursor: pointer;">âŒ</button>
        </div>
        
        <div style="background: #e3f2fd; border: 1px solid #2196f3; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
          <h4 style="margin: 0 0 10px 0; color: #1976d2;">ğŸ’¡ How to Use</h4>
          <p style="margin: 0; color: #1565c0;">Enter food ingredients (one per line or separated by commas) to check if they contain any items from your current intolerance profile.</p>
        </div>
        
        <div style="margin-bottom: 20px;">
          <label for="testIngredientInput" style="display: block; margin-bottom: 8px; font-weight: bold; color: #333;">Enter Food Ingredients:</label>
          <textarea id="testIngredientInput" placeholder="Enter food ingredients here...&#10;Example:&#10;wheat flour, milk, eggs, sugar" rows="6" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-family: inherit; font-size: 14px; resize: vertical;"></textarea>
        </div>
        
        <div style="text-align: center; margin-bottom: 20px;">
          <button onclick="testFoodIngredients()" style="background-color: #28a745; color: white; border: none; border-radius: 8px; padding: 12px 24px; font-size: 16px; cursor: pointer; margin-right: 10px;">ğŸ” Analyze Ingredients</button>
          <button onclick="clearTestIngredients()" style="background-color: #6c757d; color: white; border: none; border-radius: 8px; padding: 12px 24px; font-size: 14px; cursor: pointer;">Clear</button>
        </div>
        
        <div id="testIngredientResults" style="min-height: 50px;"></div>
      </div>
    </div>

    <!-- Diet Plan Modal -->
    <div id="dietPlanModal" class="modal" style="display: none;">
      <div class="modal-content" style="max-width: 700px; max-height: 80vh; overflow-y: auto;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h2 style="margin: 0; color: #4b0082;">ğŸ“‹ Analyze Diet Plan</h2>
          <button onclick="closeDietPlanModal()" style="background-color: #dc3545; color: white; border: none; border-radius: 4px; padding: 8px 12px; cursor: pointer;">âŒ</button>
        </div>
        
        <div style="background: #e3f2fd; border: 1px solid #2196f3; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
          <h4 style="margin: 0 0 10px 0; color: #1976d2;">ğŸ’¡ Supported File Types</h4>
          <p style="margin: 0; color: #1565c0;">Upload diet plans, meal plans, or ingredient lists in various formats to check for potential intolerance issues.</p>
        </div>
        
        <div style="margin-bottom: 20px;">
          <label for="dietPlanUploadModal" style="display: block; margin-bottom: 8px; font-weight: bold; color: #333;">Select Your File:</label>
          <input type="file" id="dietPlanUploadModal" accept=".txt,.pdf,.docx,.csv,.json" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-family: inherit; margin-bottom: 10px;">
          <div style="font-size: 12px; color: #666; text-align: center; margin-bottom: 15px;">
            ğŸ’¡ Supported formats: TXT, PDF, DOCX, CSV, JSON
          </div>
        </div>
        
        <div style="text-align: center; margin-bottom: 20px;">
          <button onclick="analyzeDietPlan()" style="background-color: #28a745; color: white; border: none; border-radius: 8px; padding: 12px 24px; font-size: 16px; cursor: pointer;">ğŸ” Analyze Diet Plan</button>
        </div>
        
        <div id="dietPlanResultsModal" style="min-height: 50px;"></div>
      </div>
    </div>

    <!-- Terms Modal -->
    <div id="termsModal" class="modal" style="display: none;">
      <div class="modal-content">
        <div style="padding: 1rem; font-family: Arial, sans-serif; max-height: 70vh; overflow-y: auto;">
          <h2 style="text-align: center;">Terms of Service & Privacy Policy</h2>
          <p style="text-align: center;"><em>Effective Date: August 4, 2025</em><br>
          <strong>Publisher:</strong> Ember Worldwide Productions LLC</p>

          <h3>1. Use at Your Own Risk</h3>
          <p>This app is provided for informational and entertainment purposes only. It is not intended to diagnose, treat, or replace medical advice from a licensed professional. You assume full responsibility for any dietary decisions made using this tool.</p>

          <h3>2. No Medical or Nutritional Liability</h3>
          <p>My DNA Diet offers food intolerance insights based on user-provided or third-party data. The creators make no warranties regarding the accuracy, completeness, or fitness of any information provided. Always consult a healthcare provider before making dietary changes.</p>

          <h3>3. Privacy & Data Collection</h3>
          <ul>
            <li>No login is required</li>
            <li>No personal identifiers are transmitted</li>
            <li>Camera access is used only for scanning labels and is not recorded or stored</li>
            <li>Ingredient data is processed locally and not saved to any server</li>
          </ul>
          <p>If future versions implement cloud features or authentication, this policy will be updated accordingly.</p>

          <h3>4. Intellectual Property</h3>
          <p>All content and functionality within the app â€” including branding, layout, and code â€” are property of Ember Worldwide Productions LLC. Unauthorized reproduction, reverse engineering, or redistribution is prohibited.</p>

          <h3>5. Acceptable Use</h3>
          <p>Users agree not to abuse, interfere with, or attempt to reverse-engineer any part of the application. Automated tools, scraping bots, or malicious inputs are prohibited.</p>

          <h3>6. Changes to the App</h3>
          <p>Features may be modified, added, or removed at any time without notice. Continued use of the app signifies acceptance of any changes.</p>

          <h3>7. Contact</h3>
          <p>For inquiries or legal questions, contact us at:<br>
          <strong>contact@emberworldwide.com</strong></p>

          <p style="margin-top: 2rem;"><strong>By using this app, you agree to these Terms of Service and Privacy Policy.</strong></strong></p>
        </div>
        <button onclick="closeTermsModal()">Close</button>
      </div>
    </div>

    <!-- Onboarding Modal -->
    <div id="onboardingModal" class="modal" style="display: none;">
      <div class="modal-content" style="max-width: 700px; max-height: 90vh; overflow-y: auto;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h2 style="margin: 0; color: #4b0082;">ğŸš€ Welcome to My DNA Diet!</h2>
          <button id="closeOnboarding" style="background-color: #dc3545; color: white; border: none; border-radius: 4px; padding: 8px 12px; cursor: pointer;">âŒ</button>
        </div>
        
        <div id="onboardingSteps">
          <!-- Step 1: Welcome -->
          <div id="step1" class="onboarding-step">
            <div style="text-align: center; margin-bottom: 30px;">
              <div style="font-size: 48px; margin-bottom: 20px;">ğŸ§¬</div>
              <h3 style="color: #4b0082; margin-bottom: 15px;">Your Personal Food Intolerance Scanner</h3>
              <p style="font-size: 16px; line-height: 1.6; color: #666;">
                Whether you have DNA test results, medical restrictions, or want to try different diets, 
                this app helps you identify what foods are safe for you.
              </p>
            </div>
            
            <div style="background: linear-gradient(135deg, #e8f5e8, #f0f8ff); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
              <h4 style="margin: 0 0 15px 0; color: #1976d2;">âœ¨ What You Can Do:</h4>
              <ul style="margin: 0; padding-left: 20px; color: #1565c0;">
                <li>ğŸ“¸ Scan food labels with your camera</li>
                <li>ğŸ§¬ Upload DNA test results or medical documents</li>
                <li>ğŸ“‹ Import diet plans (Keto, Paleo, etc.)</li>
                <li>ğŸ”„ Switch between different dietary approaches</li>
                <li>ğŸ“± Use on any device, no account needed</li>
              </ul>
            </div>
            
            <div style="text-align: center;">
              <button onclick="nextOnboardingStep()" style="background-color: #4b0082; color: white; border: none; border-radius: 8px; padding: 15px 30px; font-size: 16px; cursor: pointer;">
                Get Started â†’
              </button>
            </div>
          </div>

          <!-- Step 2: Choose Your Starting Point -->
          <div id="step2" class="onboarding-step" style="display: none;">
            <h3 style="color: #4b0082; text-align: center; margin-bottom: 25px;">How would you like to start?</h3>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
              <div class="onboarding-option" onclick="selectOnboardingOption('dna')" style="cursor: pointer; border: 2px solid #e0e0e0; border-radius: 12px; padding: 20px; text-align: center; transition: all 0.3s;">
                <div style="font-size: 36px; margin-bottom: 15px;">ğŸ§¬</div>
                <h4 style="margin: 0 0 10px 0; color: #4b0082;">DNA Test Results</h4>
                <p style="margin: 0; font-size: 14px; color: #666;">Upload results from 5Strands, 23andMe, or other DNA testing companies</p>
              </div>
              
              <div class="onboarding-option" onclick="selectOnboardingOption('medical')" style="cursor: pointer; border: 2px solid #e0e0e0; border-radius: 12px; padding: 20px; text-align: center; transition: all 0.3s;">
                <div style="font-size: 36px; margin-bottom: 15px;">ğŸ¥</div>
                <h4 style="margin: 0 0 10px 0; color: #4b0082;">Medical Restrictions</h4>
                <p style="margin: 0; font-size: 14px; color: #666;">Celiac disease, food allergies, or doctor's dietary orders</p>
              </div>
              
              <div class="onboarding-option" onclick="selectOnboardingOption('diet')" style="cursor: pointer; border: 2px solid #e0e0e0; border-radius: 12px; padding: 20px; text-align: center; transition: all 0.3s;">
                <div style="font-size: 36px; margin-bottom: 15px;">ğŸ¥—</div>
                <h4 style="margin: 0 0 10px 0; color: #4b0082;">Diet Plan</h4>
                <p style="margin: 0; font-size: 14px; color: #666;">Keto, Paleo, Root & Flow, or any other diet plan</p>
              </div>
              
              <div class="onboarding-option" onclick="selectOnboardingOption('manual')" style="cursor: pointer; border: 2px solid #e0e0e0; border-radius: 12px; padding: 20px; text-align: center; transition: all 0.3s;">
                <div style="font-size: 36px; margin-bottom: 15px;">âœï¸</div>
                <h4 style="margin: 0 0 10px 0; color: #4b0082;">Manual Entry</h4>
                <p style="margin: 0; font-size: 14px; color: #666;">Add your intolerances one by one</p>
              </div>
            </div>
            
            <div style="text-align: center;">
              <button onclick="previousOnboardingStep()" style="background-color: #6c757d; color: white; border: none; border-radius: 8px; padding: 12px 24px; font-size: 14px; cursor: pointer; margin-right: 10px;">
                â† Back
              </button>
            </div>
          </div>

          <!-- Step 3: Profile Setup -->
          <div id="step3" class="onboarding-step" style="display: none;">
            <h3 style="color: #4b0082; text-align: center; margin-bottom: 25px;">Create Your Profile</h3>
            
            <div style="margin-bottom: 25px;">
              <label for="profileName" style="display: block; margin-bottom: 8px; font-weight: bold; color: #333;">Profile Name:</label>
              <input type="text" id="profileName" placeholder="e.g., My Profile, John's Diet, Keto Plan" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px;">
            </div>
            
            <div id="onboardingFileUpload" style="display: none; margin-bottom: 25px;">
              <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #333;">Upload Your File:</label>
              <input type="file" id="onboardingFileInput" accept=".json,.pdf,.docx,.txt,.csv" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px;">
              <small style="color: #666; display: block; margin-top: 5px;">
                Supported formats: JSON, PDF, DOCX, TXT, CSV
              </small>
            </div>
            
            <div id="onboardingManualEntry" style="display: none; margin-bottom: 25px;">
              <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #333;">Add Your First Intolerance:</label>
              <div style="display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 10px; align-items: end;">
                <input type="text" id="onboardingItemInput" placeholder="e.g., Gluten, Dairy, Nuts" style="padding: 10px; border: 2px solid #e0e0e0; border-radius: 6px;">
                <select id="onboardingCategoryInput" style="padding: 10px; border: 2px solid #e0e0e0; border-radius: 6px;">
                  <option value="Grain">Grain</option>
                  <option value="Dairy">Dairy</option>
                  <option value="Nuts">Nuts</option>
                  <option value="Protein">Protein</option>
                  <option value="Other">Other</option>
                </select>
                <select id="onboardingLevelInput" style="padding: 10px; border: 2px solid #e0e0e0; border-radius: 6px;">
                  <option value="1">Mild</option>
                  <option value="2">Moderate</option>
                  <option value="3">Severe</option>
                </select>
                <button onclick="addOnboardingIntolerance()" style="background-color: #28a745; color: white; border: none; border-radius: 6px; padding: 10px 16px; cursor: pointer;">Add</button>
              </div>
              <div id="onboardingIntolerancesList" style="margin-top: 15px; max-height: 150px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 6px; padding: 10px; background: #f9f9f9;">
                <!-- Added intolerances will appear here -->
              </div>
            </div>
            
            <div style="text-align: center;">
              <button onclick="previousOnboardingStep()" style="background-color: #6c757d; color: white; border: none; border-radius: 8px; padding: 12px 24px; font-size: 14px; cursor: pointer; margin-right: 10px;">
                â† Back
              </button>
              <button id="createProfileBtn" onclick="createOnboardingProfile()" style="background-color: #4b0082; color: white; border: none; border-radius: 8px; padding: 12px 24px; font-size: 14px; cursor: pointer;">
                Create Profile
              </button>
            </div>
          </div>

          <!-- Step 4: Success -->
          <div id="step4" class="onboarding-step" style="display: none;">
            <div style="text-align: center; padding: 40px 20px;">
              <div style="font-size: 64px; margin-bottom: 20px;">ğŸ‰</div>
              <h3 style="color: #4b0082; margin-bottom: 20px;">Profile Created Successfully!</h3>
              <p style="font-size: 16px; line-height: 1.6; color: #666; margin-bottom: 30px;">
                You're all set! Your profile is now active and ready to use.
              </p>
              
              <div style="background: linear-gradient(135deg, #e8f5e8, #f0f8ff); border-radius: 12px; padding: 20px; margin-bottom: 30px;">
                <h4 style="margin: 0 0 15px 0; color: #1976d2;">ğŸš€ Next Steps:</h4>
                <ul style="margin: 0; padding-left: 20px; color: #1565c0; text-align: left;">
                  <li>ğŸ“¸ Try scanning a food label</li>
                  <li>ğŸ§¬ Test some ingredients manually</li>
                  <li>ğŸ“‹ Upload more diet plans</li>
                  <li>ğŸ”„ Switch between profiles anytime</li>
                </ul>
              </div>
              
                        <button onclick="completeOnboarding()" style="background-color: #28a745; color: white; border: none; border-radius: 8px; padding: 15px 30px; font-size: 16px; cursor: pointer;">
            Start Using My DNA Diet! ğŸ§¬
          </button>
          
          <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 1px solid #dee2e6;">
            <h4 style="margin: 0 0 10px 0; color: #6c757d;">ğŸ”§ Debug Info</h4>
            <button onclick="showDebugInfo()" style="background-color: #6c757d; color: white; border: none; border-radius: 4px; padding: 8px 16px; cursor: pointer; font-size: 12px;">Show Debug Info</button>
            <div id="debugInfo" style="margin-top: 10px; font-size: 12px; color: #666; display: none;"></div>
          </div>
            </div>
          </div>
        </div>
        
        <!-- Progress indicator -->
        <div style="display: flex; justify-content: center; margin-top: 30px;">
          <div class="onboarding-dot" data-step="1" style="width: 12px; height: 12px; border-radius: 50%; background-color: #4b0082; margin: 0 5px;"></div>
          <div class="onboarding-dot" data-step="2" style="width: 12px; height: 12px; border-radius: 50%; background-color: #e0e0e0; margin: 0 5px;"></div>
          <div class="onboarding-dot" data-step="3" style="width: 12px; height: 12px; border-radius: 50%; background-color: #e0e0e0; margin: 0 5px;"></div>
          <div class="onboarding-dot" data-step="4" style="width: 12px; height: 12px; border-radius: 50%; background-color: #e0e0e0; margin: 0 5px;"></div>
        </div>
      </div>
    </div>

    <script src="script.js"></script>
  </div>
</body>
</html>
